# سياسات الدرجات (Subsystem 01)
## `DDL_POLICIES.sql`

هذا النظام الفرعي هو "دستور الدرجات" في المدرسة: من يدرّس؟ ما وزن كل مكوّن؟ وما حد النجاح؟

## شرح مبسط
- قبل إدخال أي درجة، يجب اعتماد سياسة واضحة لكل صف ومادة.
- السياسة تحدد سقف: الاختبار، الواجب، المواظبة، النشاط، المساهمة.
- يمكن إضافة مكونات خاصة بالمدرسة مثل: مشروع، سلوك، مهارة.
- تكليف المعلمين هنا يمنع إدخال درجات من معلم غير مكلف.

## الجداول الأساسية

| الجدول | وظيفته |
|---|---|
| `lookup_grading_statuses` | حالات اعتماد الدرجات (مسودة، مراجعة، معتمد...) |
| `grading_policies` | الأوزان وحد النجاح لكل عام/صف/مادة/نوع تقييم |
| `grading_policy_custom_components` | مكونات تقييم إضافية مرنة لكل سياسة |
| `teacher_assignments` | تكليف المعلم بالمادة والشعبة والفصل |

## شرح الجداول والأعمدة

### 1) `lookup_grading_statuses`
| العمود | الترجمة | الهدف |
|---|---|---|
| `id` | رقم الحالة | مفتاح أساسي |
| `name_ar` | اسم الحالة | اسم واضح للمستخدم |
| `is_final` | حالة نهائية | إذا كانت نهائية يمنع التعديل |
| `is_active` | تفعيل الحالة | إخفاء/إظهار الحالة |

### 2) `grading_policies`
| العمود | الترجمة | الهدف |
|---|---|---|
| `academic_year_id` | العام الدراسي | تحديد نطاق السياسة |
| `grade_level_id` | الصف الدراسي | سياسة خاصة بكل صف |
| `subject_id` | المادة | سياسة خاصة بكل مادة |
| `exam_type_id` | نوع التقييم | شهري/نهائي/منتصف... |
| `max_exam_score` | سقف الاختبار | منع درجات أعلى من المحدد |
| `max_homework_score` | سقف الواجب | وزن الواجب في التقييم |
| `max_attendance_score` | سقف المواظبة | وزن الحضور |
| `max_activity_score` | سقف النشاط | تقييم النشاط الصفي |
| `max_contribution_score` | سقف المساهمة | تقييم السلوك/المشاركة |
| `passing_score` | حد النجاح | النسبة المطلوبة للنجاح |
| `is_default` | سياسة افتراضية | تُستخدم كقالب للنسخ السنوي |

### 3) `grading_policy_custom_components`
| العمود | الترجمة | الهدف |
|---|---|---|
| `policy_id` | مرجع السياسة | ربط المكوّن بسياسة محددة |
| `component_code` | رمز ثابت | اسم تقني ثابت مثل `PROJECT` |
| `component_name_ar` | اسم عربي | الاسم المعروض للمستخدم |
| `max_score` | سقف المكوّن | الحد الأعلى لهذا العنصر |
| `calculation_mode` | طريقة الحساب | يدوي أو آلي حسب المصدر |
| `include_in_monthly` | يدخل شهريًا | هل يحتسب في الشهر؟ |
| `include_in_semester` | يدخل فصليًا | هل يحتسب في الفصل؟ |
| `sort_order` | ترتيب العرض | ترتيب المكوّن في الشاشة |
| `is_active` | التفعيل | تشغيل/إيقاف المكوّن |

### 4) `teacher_assignments`
| العمود | الترجمة | الهدف |
|---|---|---|
| `academic_year_id` | العام | أرشفة التكليف سنويًا |
| `semester_id` | الفصل | توزيع الفصل الأول/الثاني |
| `employee_id` | المعلم | من المسؤول عن الإدخال |
| `subject_id` | المادة | نطاق التكليف |
| `classroom_id` | الشعبة | الشعبة المكلف عليها |
| `is_primary` | معلم أساسي | الأساسي أو بديل |
| `is_active` | التكليف فعال | إيقاف دون حذف |
| `notes` | ملاحظات | تفاصيل إدارية |

## سير العملية
1. الإدارة تعتمد حالات العمل في `lookup_grading_statuses`.
2. تُبنى سياسة درجات لكل صف ومادة ونوع تقييم.
3. تُضاف مكونات مخصصة عند الحاجة.
4. يتم تكليف المعلمين قبل بداية الإدخال.
5. بقية الأنظمة تعتمد هذه السياسة تلقائيًا.

## سجلات توضيحية

### عينة 10 سياسات (`grading_policies`)
| id | academic_year_id | grade_level_id | subject_id | exam_type_id | max_exam_score | max_homework_score | max_attendance_score | max_activity_score | max_contribution_score | passing_score | is_default |
|---|---:|---:|---:|---:|---:|---:|---:|---:|---:|---:|---:|
| 1 | 1 | 8 | 1 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 2 | 1 | 8 | 2 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 3 | 1 | 8 | 3 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 4 | 1 | 8 | 4 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 5 | 1 | 8 | 5 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 6 | 1 | 8 | 6 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 7 | 1 | 8 | 7 | 1 | 20 | 5 | 5 | 5 | 4 | 50 | 1 |
| 8 | 1 | 8 | 1 | 3 | 40 | 0 | 0 | 0 | 0 | 50 | 0 |
| 9 | 1 | 8 | 2 | 3 | 40 | 0 | 0 | 0 | 0 | 50 | 0 |
| 10 | 1 | 8 | 3 | 3 | 40 | 0 | 0 | 0 | 0 | 50 | 0 |

### عينة 10 تكليفات (`teacher_assignments`)
| id | academic_year_id | semester_id | employee_id | subject_id | classroom_id | is_primary | is_active | notes |
|---|---:|---:|---:|---:|---:|---:|---:|---|
| 1 | 1 | 1 | 25 | 1 | 41 | 1 | 1 | معلم أساسي |
| 2 | 1 | 1 | 26 | 2 | 41 | 1 | 1 | معلم أساسي |
| 3 | 1 | 1 | 27 | 3 | 41 | 1 | 1 | معلم أساسي |
| 4 | 1 | 1 | 28 | 4 | 41 | 1 | 1 | معلم أساسي |
| 5 | 1 | 1 | 29 | 5 | 41 | 1 | 1 | معلم أساسي |
| 6 | 1 | 1 | 30 | 6 | 41 | 1 | 1 | معلم أساسي |
| 7 | 1 | 1 | 31 | 7 | 41 | 1 | 1 | معلم أساسي |
| 8 | 1 | 1 | 32 | 1 | 42 | 1 | 1 | شعبة ثانية |
| 9 | 1 | 1 | 33 | 2 | 42 | 1 | 1 | شعبة ثانية |
| 10 | 1 | 1 | 34 | 3 | 42 | 1 | 1 | شعبة ثانية |

### عينة مكونات مخصصة (`grading_policy_custom_components`)
| id | policy_id | component_code | component_name_ar | max_score | calculation_mode | include_in_monthly | include_in_semester | sort_order | is_active |
|---|---:|---|---|---:|---|---:|---:|---:|---:|
| 101 | 3 | PROJECT | المشروع | 3.0 | MANUAL | 1 | 1 | 1 | 1 |
| 102 | 3 | BEHAVIOR | السلوك | 2.0 | MANUAL | 1 | 1 | 2 | 1 |
| 103 | 3 | READING | مهارة القراءة | 1.0 | MANUAL | 1 | 1 | 3 | 1 |
| 104 | 3 | PRACTICAL | مهارة عملية | 2.0 | MANUAL | 1 | 1 | 4 | 1 |
| 105 | 3 | PARTICIPATION | المشاركة الصفية | 1.0 | MANUAL | 1 | 1 | 5 | 1 |
| 106 | 3 | ENRICHMENT | نشاط إثرائي | 1.0 | MANUAL | 0 | 1 | 6 | 1 |
