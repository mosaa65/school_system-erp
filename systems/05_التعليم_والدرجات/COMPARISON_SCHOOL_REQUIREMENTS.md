# مقارنة نظام التعليم والدرجات مع متطلبات المدرسة
## مصدر المتطلبات: `school.txt`

---

## نطاق المقارنة
- هذه المقارنة تغطي فقط ما يخص **نظام التعليم والدرجات (System 05)**.
- تم تجاهل البنود الأمنية/المالية/واجهة المستخدم العامة إلا إذا كانت تؤثر مباشرة على بيانات أو منطق الدرجات.
- المقارنة تمت على مستوى SQL الحالي في:
  - `DDL_POLICIES.sql`
  - `DDL_EXAMS.sql`
  - `DDL_HOMEWORKS.sql`
  - `DDL_MONTHLY.sql`
  - `DDL_RESULTS.sql`
  - `DDL_LESSON_PREP.sql`
  - `DDL_AUDIT.sql`
  - `DDL_REPORTS.sql`

---

## ملخص سريع
| الحالة | العدد |
|---|---|
| مطابق بالكامل | 3 |
| موجود بصياغة أكثر احترافية | 5 |
| مطابق جزئيا | 7 |
| غير موجود | 3 |

---

## تحديث مهم (2026-02-14 — v3.3)
تمت معالجة الفجوات الجوهرية التالية في النسخة 3.3:
- إضافة **المساهمة** داخل المحصلة الشهرية (`contribution_score`) في `monthly_grades`.
- إضافة **مكونات مخصصة غير محدودة** لكل سياسة عبر `grading_policy_custom_components`.
- إضافة **قواعد نقل مرنة** لكل عام/صف عبر `grading_outcome_rules` بدل الشروط الصلبة.
- تفعيل **`rank_in_grade`** فعلياً داخل `sp_calculate_annual_results`.
- إضافة **كسر التعادل بالاسم/المجموع** وفق `tie_break_strategy`.
- إصلاح تناقضات التقارير (`DDL_REPORTS.sql`) وربطها بالسياسات الفعلية.

> ملاحظة: الجدول التفصيلي أدناه يمثل تقييم النسخة السابقة قبل تطبيق إصلاحات v3.3.

---

## المقارنة التفصيلية

| # | المتطلب من `school.txt` | حالة المطابقة | ما يقابله في النظام الحالي | الفرق الفعلي |
|---|---|---|---|---|
| 1 | صلاحيات الدرجات حسب صف/صفوف/كل الصفوف (`school.txt:37`, `school.txt:38`, `school.txt:66`) | مطابق جزئيا | يوجد توثيق منشئ/معتمد (`created_by`, `approved_by_user_id`) وحالات اعتماد (`grading_status_id`) في جداول النتائج (`DDL_RESULTS.sql:29`, `DDL_RESULTS.sql:90`, `DDL_RESULTS.sql:152`) | لا يوجد في System 05 وحده مصفوفة صلاحيات تفصيلية حسب صف؛ هذا غالبا طبقة نظام الصلاحيات (System 01). |
| 2 | لا تعديل للدرجات إلا بموافقة المدير (`school.txt:5112` إلى `school.txt:5114`, `school.txt:5241` إلى `school.txt:5244`) | موجود بصياغة أكثر احترافية | قفل تلقائي للنتائج المعتمدة عبر Triggers (`DDL_AUDIT.sql:47`, `DDL_AUDIT.sql:58`, `DDL_AUDIT.sql:69`) + حالات اعتماد رسمية | بدل شرط نصي يدوي، يوجد Governance تقني يمنع التعديل بعد الاعتماد. |
| 3 | فقرة نتيجة الشهر وتصديرها (`school.txt:906` إلى `school.txt:913`, `school.txt:72`) | مطابق جزئيا | Views للتقرير الشهري (`DDL_REPORTS.sql:45`, `DDL_REPORTS.sql:108`) | موجود منطق استخراج البيانات، لكن شكل التصدير/تنسيق الطباعة النهائي ليس ضمن SQL. |
| 4 | مكونات درجة الشهر: مواظبة + واجب + نشاط + اختبار (`school.txt:5158`) | مطابق بالكامل | نفس المكونات موجودة في `monthly_grades` (`DDL_MONTHLY.sql:21` إلى `DDL_MONTHLY.sql:24`) | مطابق مباشرة. |
| 5 | إضافة جانب "المساهمة" ضمن درجة الشهر (`school.txt:5158`, `school.txt:5198`) | غير موجود | لا يوجد عمود `contribution_score` في `monthly_grades` | النظام الحالي لا يحسب مساهمة مجتمعية داخل نظام الدرجات. |
| 6 | أوزان شهرية ثابتة (6/3/3/4/4) مع قابلية ضبط (`school.txt:5193` إلى `school.txt:5198`) | موجود بصياغة أكثر احترافية | أوزان مرنة عبر `grading_policies` (`DDL_POLICIES.sql:38` إلى `DDL_POLICIES.sql:44`) وتطبيقها آليا في `sp_calculate_monthly_grades` (`DDL_MONTHLY.sql:88`, `DDL_MONTHLY.sql:109`) | بدل أرقام ثابتة، تم تحويلها إلى سياسات قابلة للضبط لكل صف/مادة/عام. |
| 7 | ما كان محسوبا يكتب تلقائي وما كان يدوي يبقى يدوي (`school.txt:1914`, `school.txt:1915`) | موجود بصياغة أكثر احترافية | آلي: attendance/homework/exam. يدوي: `activity_score` (`DDL_MONTHLY.sql:84`) + واجب يدوي اختياري `manual_grade` (`DDL_HOMEWORKS.sql:93`) | نفس الفكرة مطبقة بمعمارية أوضح بين المدخل اليدوي والحساب الآلي. |
| 8 | منع إدخال درجة أعلى من الدرجة المستحقة (`school.txt:5418` إلى `school.txt:5421`) | مطابق بالكامل | تحقق قبل INSERT/UPDATE في `student_exam_scores` (`DDL_EXAMS.sql:123`, `DDL_EXAMS.sql:165`) | مطابق مباشر مع رسالة خطأ. |
| 9 | التعامل مع الغياب (غ) في الدرجات (`school.txt:5217`, `school.txt:5417`) | موجود بصياغة أكثر احترافية | تمثيل الغياب حقليا بـ `is_present` + `absence_type` (`DDL_EXAMS.sql:97`, `DDL_EXAMS.sql:99`) مع ضبط الدرجة تلقائيا للغائب (`DDL_EXAMS.sql:145`, `DDL_EXAMS.sql:183`) | بدل إدخال نص "غ" داخل حقل الدرجة، تم فصل الغياب كنموذج بيانات أدق وأسهل للتحليل. |
| 10 | الاختبارات الشهرية والفصلية (`school.txt:1456` إلى `school.txt:1478`) | مطابق بالكامل | أنواع الفترات الامتحانية `MONTHLY` و`FINAL` وغيرها (`DDL_EXAMS.sql:27`) + جداول الاختبارات والدرجات | مطابق منطقيا مع توسعة احترافية لأنواع إضافية (`MIDTERM`, `DIAGNOSTIC`). |
| 11 | توزيع الطلاب على لجان الامتحان (`school.txt:1483` إلى `school.txt:1499`) | مطابق جزئيا | ربط أكاديمي مع جلسات اللجان عبر `exam_session_periods` (`DDL_EXAMS.sql:282`) | الربط موجود، لكن تفاصيل المقعد/المكان نفسها ليست ضمن System 05 وتبقى في System 08. |
| 12 | تحضير الموظفين للدروس (`school.txt:1232` إلى `school.txt:1245`) | مطابق جزئيا | جدول تحضير الدروس موجود (`DDL_LESSON_PREP.sql:16`) مع `prep_date`, `lesson_title`, `objectives`, `strategies`, `aids` | لا يوجد حقل صريح "محضر/غير محضر"، لكن وجود سجل التحضير + `is_approved` يغطي الجزء الأساسي. |
| 13 | الواجبات المنزلية: نوع الواجب وحالته (`school.txt:1250` إلى `school.txt:1267`) | مطابق جزئيا | نوع الواجب موجود Lookup (`DDL_HOMEWORKS.sql:20`, `DDL_HOMEWORKS.sql:44`) وحالة التنفيذ `is_completed` (`DDL_HOMEWORKS.sql:87`) | لا توجد حالات مستقلة "توبع/صحح" كحالة رسمية منفصلة. |
| 14 | نتيجة الفصل الأول والثاني مع حساب تلقائي للمجاميع (`school.txt:5289`, `school.txt:5387`, `school.txt:5485` إلى `school.txt:5560`) | موجود بصياغة أكثر احترافية | `semester_grades`, `annual_grades`, `annual_result` + إجراءات حساب آلي (`DDL_RESULTS.sql:14`, `DDL_RESULTS.sql:67`, `DDL_RESULTS.sql:130`, `DDL_RESULTS.sql:198`, `DDL_RESULTS.sql:229`) | النظام الحالي أعمق: فصل + سنوي + قرار نقل، وليس فقط نموذج كشف ثابت. |
| 15 | الترتيب على مستوى الصف والمدرسة (`school.txt:5299`, `school.txt:5306`, `school.txt:5307`, `school.txt:5490`, `school.txt:5491`) | مطابق جزئيا | `rank_in_class` و`rank_in_grade` موجودان في الجدول (`DDL_RESULTS.sql:141`, `DDL_RESULTS.sql:142`) لكن الإجراء يحسب `rank_in_class` فقط (`DDL_RESULTS.sql:350`) | ترتيب المدرسة/الصف العام (`rank_in_grade`) غير محسوب حاليا في الإجراء. |
| 16 | كسر التعادل في الترتيب حسب الاسم (`school.txt:5495`, `school.txt:5566`) | غير موجود | لا يوجد شرط Tie-break بالاسم في منطق الترتيب | الترتيب الحالي مبني على النسبة فقط. |
| 17 | تلوين الراسب بالأحمر وحدود (<10, <25, <50) (`school.txt:940`, `school.txt:5182`, `school.txt:5296`, `school.txt:5395`, `school.txt:5563`) | مطابق جزئيا | يوجد `passing_score` مرن في السياسة (`DDL_POLICIES.sql:44`) ووصف تقدير (`DDL_REPORTS.sql:17`) | التلوين الأحمر وقواعد العتبة الصلبة تفاصيل عرض (UI/Template) وليست منطق SQL مباشر. |
| 18 | بيانات الإضافة (هجري/ميلادي/اليوم/الساعة/اسم المضاف) (`school.txt:76`, `school.txt:5221` إلى `school.txt:5224`) | مطابق جزئيا | يوجد `created_at` و`created_by` في معظم الجداول (مثال: `DDL_EXAMS.sql:35`, `DDL_HOMEWORKS.sql:56`, `DDL_LESSON_PREP.sql:18`) | لا توجد حقول منفصلة للتاريخ الهجري/اليوم النصي داخل System 05. |

---

## المتطلبات الموجودة لكن بصياغة أكثر احترافية

1. **اعتماد الدرجات والحوكمة**  
بدل عبارة "لا تعدل إلا بموافقة المدير"، النظام يطبّق قفلًا فنيا إلزاميا على النتائج المعتمدة + سجل تدقيق كامل لأي تعديل.

2. **تمثيل الغياب**  
بدل إدخال حرف داخل حقل الدرجة، الغياب ممثل بحقول مخصصة (`is_present`, `absence_type`) وهذا أنظف للتحليل والإحصاء.

3. **الأوزان والسياسات**  
بدل أوزان ثابتة في النص، النظام يدعم أوزان مرنة لكل صف/مادة/عام عبر `grading_policies`.

4. **الحساب الآلي المتسلسل**  
النظام يبني خطًا واضحًا: شهري ← فصلي ← سنوي ← قرار نقل، بإجراءات مخزنة مترابطة.

5. **تحضير الدروس والواجبات**  
المتطلبات ذكرت الفكرة بشكل تشغيلي، بينما النظام يحولها لكيانات مستقلة مع فهارس وقيود وعلاقات مرجعية.

---

## الفروقات الجوهرية المتبقية

1. **جانب المساهمة المجتمعية** غير مضاف داخل درجة الشهر في System 05.
2. **الترتيب على مستوى المدرسة** (`rank_in_grade`) غير محسوب تلقائيا حاليا.
3. **سياسة كسر التعادل بالاسم** غير موجودة.
4. **تفاصيل قوالب التصدير والطباعة** (عدد النتائج في الصفحة، التلوين، صيغة الإخراج) ليست ضمن SQL الحالي.
5. **حالات الواجب التفصيلية** (`نفذ/توبع/صحح`) غير ممثلة كحالة منفصلة.

---

## الحكم النهائي
- النظام الحالي يغطي العمود الفقري للمتطلبات الأكاديمية والدرجات بشكل قوي.
- في عدة نقاط، التنفيذ الحالي **أكثر احترافية** من النص المطلوب (حوكمة، تدقيق، سياسات مرنة، فصل منطق الغياب عن الدرجة).
- الفجوات المتبقية أغلبها في:
  - تخصيصات نموذج المدرسة المحلي (المساهمة، كسر التعادل، عتبات عرض ثابتة).
  - تفاصيل واجهة/طباعة التقارير أكثر من منطق قاعدة البيانات.

**تاريخ المقارنة:** 2026-02-14
