# الواجبات المنزلية (Subsystem 03)
## `DDL_HOMEWORKS.sql`

هذا النظام الفرعي يدير الواجب من لحظة إنشائه حتى دخوله في الحساب الشهري.

## شرح مبسط
- المعلم ينشئ واجبًا لمادة وشعبة.
- النظام يجهز تلقائيًا سطر متابعة لكل طالب في الشعبة.
- يتم تحديث حالة كل طالب: نفّذ/لم ينفّذ، مع درجة يدوية عند الحاجة.
- الناتج النهائي يذهب إلى نظام المحصلة الشهرية.

## الجداول الأساسية

| الجدول | وظيفته |
|---|---|
| `lookup_homework_types` | أنواع الواجبات (واجب، بحث، مشروع...) |
| `homeworks` | تعريف الواجب (عنوان، تاريخ، مادة، درجة عظمى) |
| `student_homeworks` | متابعة تنفيذ كل طالب للواجب |

## كائنات مساعدة مهمة

| الكائن | فائدته |
|---|---|
| `v_homework_effective_grade` | يحسب الدرجة الفعلية للطالب (يدوي أو تلقائي) |
| `v_homework_summary` | ملخص الالتزام والإنجاز على مستوى الواجب |
| `sp_populate_student_homeworks` | تعبئة الطلاب تلقائيًا عند إنشاء الواجب |

## شرح الجداول والأعمدة

### 1) `lookup_homework_types`
| العمود | الترجمة | الهدف |
|---|---|---|
| `id` | رقم النوع | مفتاح أساسي |
| `name_ar` | اسم النوع | اسم ظاهر للمستخدم |
| `is_active` | التفعيل | تشغيل/إيقاف النوع |

### 2) `homeworks`
| العمود | الترجمة | الهدف |
|---|---|---|
| `academic_year_id` | العام | أرشفة سنوية |
| `semester_id` | الفصل | ربط الواجب بالفصل |
| `month_id` | الشهر الأكاديمي | ربط الواجب بالحساب الشهري |
| `created_by` | منشئ الواجب | تتبع المسؤول |
| `classroom_id` | الشعبة | الجمهور المستهدف |
| `subject_id` | المادة | مادة الواجب |
| `homework_type_id` | نوع الواجب | منزلي/بحث/مشروع |
| `homework_date` | تاريخ الإعطاء | بداية التكليف |
| `due_date` | تاريخ التسليم | الموعد النهائي |
| `title` | عنوان الواجب | اسم واضح |
| `content` | تفاصيل الواجب | تعليمات التنفيذ |
| `max_grade` | الدرجة العظمى | سقف التقييم |
| `is_active` | حذف ناعم | إيقاف الواجب بدون فقد البيانات |

### 3) `student_homeworks`
| العمود | الترجمة | الهدف |
|---|---|---|
| `homework_id` | مرجع الواجب | ربط الطالب بالواجب |
| `enrollment_id` | مرجع الطالب المقيد | الطالب داخل الشعبة |
| `is_completed` | تم التنفيذ | تتبع الالتزام |
| `submitted_at` | وقت التسليم | معرفة الالتزام بالموعد |
| `manual_grade` | درجة يدوية | إدخال تقييم مباشر إن لزم |
| `notes` | ملاحظات | توثيق أسباب التأخير أو الملاحظات |

## سير العملية
1. المعلم ينشئ الواجب في `homeworks`.
2. النظام يعبئ الطلاب تلقائيًا في `student_homeworks`.
3. المعلم يحدث التنفيذ والدرجة اليدوية عند الحاجة.
4. النظام يحسب الدرجة الفعلية عبر `v_homework_effective_grade`.
5. نظام المحصلة الشهرية يقرأ الناتج ويدمجه في `homework_score`.

## سجلات توضيحية

### أنواع الواجبات (`lookup_homework_types`)
| id | name_ar | is_active |
|---|---|---:|
| 1 | واجب منزلي | 1 |
| 2 | بحث | 1 |
| 3 | مشروع | 1 |
| 4 | تقرير | 1 |
| 5 | نشاط صفي | 1 |
| 6 | أخرى | 1 |

### عينة 10 واجبات (`homeworks`)
| id | academic_year_id | semester_id | month_id | classroom_id | subject_id | homework_type_id | homework_date | due_date | title | max_grade |
|---|---:|---:|---:|---:|---:|---:|---|---|---|---:|
| 7001 | 1 | 1 | 1 | 41 | 3 | 1 | 2026-09-03 | 2026-09-05 | واجب 1 | 5 |
| 7002 | 1 | 1 | 1 | 41 | 3 | 1 | 2026-09-07 | 2026-09-09 | واجب 2 | 5 |
| 7003 | 1 | 1 | 1 | 41 | 3 | 2 | 2026-09-10 | 2026-09-13 | بحث قصير | 5 |
| 7004 | 1 | 1 | 2 | 41 | 3 | 1 | 2026-10-02 | 2026-10-04 | واجب 3 | 5 |
| 7005 | 1 | 1 | 2 | 41 | 3 | 1 | 2026-10-06 | 2026-10-08 | واجب 4 | 5 |
| 7006 | 1 | 1 | 2 | 41 | 3 | 5 | 2026-10-09 | 2026-10-10 | نشاط صفي | 5 |
| 7007 | 1 | 1 | 3 | 41 | 3 | 1 | 2026-11-03 | 2026-11-05 | واجب 5 | 5 |
| 7008 | 1 | 1 | 3 | 41 | 3 | 1 | 2026-11-08 | 2026-11-10 | واجب 6 | 5 |
| 7009 | 1 | 1 | 3 | 41 | 3 | 3 | 2026-11-12 | 2026-11-16 | مشروع مصغر | 10 |
| 7010 | 1 | 1 | 4 | 41 | 3 | 1 | 2026-12-01 | 2026-12-03 | واجب 7 | 5 |

### عينة 10 متابعات طلاب (`student_homeworks`)
| id | homework_id | enrollment_id | is_completed | submitted_at | manual_grade | notes |
|---|---:|---:|---:|---|---:|---|
| 9001 | 7001 | 5001 | 1 | 2026-09-05 08:40 | NULL | تم التسليم |
| 9002 | 7001 | 5002 | 1 | 2026-09-05 09:05 | 4.5 | جيد |
| 9003 | 7001 | 5003 | 0 | NULL | NULL | لم يسلم |
| 9004 | 7001 | 5004 | 1 | 2026-09-05 08:55 | NULL | تم التسليم |
| 9005 | 7001 | 5005 | 1 | 2026-09-05 08:35 | 5.0 | ممتاز |
| 9006 | 7001 | 5006 | 1 | 2026-09-05 09:15 | NULL | تم التسليم |
| 9007 | 7001 | 5007 | 0 | NULL | NULL | غياب |
| 9008 | 7001 | 5008 | 1 | 2026-09-05 09:20 | 4.0 | جيد |
| 9009 | 7001 | 5009 | 1 | 2026-09-05 08:50 | NULL | تم التسليم |
| 9010 | 7001 | 5010 | 1 | 2026-09-05 08:45 | NULL | تم التسليم |
