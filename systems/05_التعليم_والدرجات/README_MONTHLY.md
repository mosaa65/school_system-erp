# ๐ ุงููุญุตูุงุช ุงูุดูุฑูุฉ ูุงูุญุณุงุจ ุงูุขูู
## DDL_MONTHLY โ Monthly Grades + Auto-Calculation

---

## ๐ ุจุทุงูุฉ ุงูููู
| ุงูุจูุฏ | ุงููููุฉ |
|-------|--------|
| **ุงูููู** | `DDL_MONTHLY.sql` |
| **ุชุฑุชูุจ ุงูุชูููุฐ** | 4๏ธโฃ ุงูุฑุงุจุน |
| **ุนุฏุฏ ุงูุนูุงุตุฑ** | 2 ุฌุฏุงูู + 2 Views + 1 Stored Procedure + Triggers ุชุญูู |
| **ูุนุชูุฏ ุนูู** | DDL_POLICIES, DDL_EXAMS, DDL_HOMEWORKS, System 04 (ุงูุญุถูุฑ) |

---

## ๐ ุงูููุฏูุฉ
ุงููุญุตูุฉ ุงูุดูุฑูุฉ ูู **ุชุฌููุน ุฃุฏุงุก ุงูุทุงูุจ ุฎูุงู ุดูุฑ ูุงุญุฏ** ูู ูุงุฏุฉ ูุนููุฉ. ุงููููุฐุฌ ุงูุญุงูู ูุฑู ููุชุถูู: ุงูููุงุธุจุฉ + ุงููุงุฌุจุงุช + ุงููุดุงุท + ุงููุณุงููุฉ + ุงูููููุงุช ุงููุฎุตุตุฉ + ุงูุงุฎุชุจุงุฑุงุช.

```mermaid
graph TD
    ATT["System 04<br/>ุงูุญุถูุฑ ูุงูุบูุงุจ"] -->|v_auto_attendance_score| MG["monthly_grades<br/>ุงููุญุตูุฉ ุงูุดูุฑูุฉ"]
    HW["DDL_HOMEWORKS<br/>ุงููุงุฌุจุงุช"] -->|v_auto_homework_score| MG
    EX["DDL_EXAMS<br/>ุงูุงุฎุชุจุงุฑุงุช"] -->|"exam_score"| MG
    T["ุงููุนูู"] -->|"ูุฏูู"| ACT["activity_score<br/>ุฏุฑุฌุฉ ุงููุดุงุท"]
    ACT --> MG
    
    style ATT fill:#1565c0,color:#fff
    style HW fill:#7b1fa2,color:#fff
```

### ๐งฎ ุงููุนุงุฏูุฉ
```
monthly_total = attendance_score (ุขูู ูู ุงูุญุถูุฑ)
              + homework_score (ุขูู ูู ุงููุงุฌุจุงุช)  
              + activity_score (ูุฏูู ูู ุงููุนูู)
              + contribution_score (ูุฏูู ูู ุงููุนูู)
              + custom_components_score (ุญุณุจ ุณูุงุณุฉ ุงููุฏุฑุณุฉ)
              + exam_score (ูู ุงูุงุฎุชุจุงุฑุงุช)
```

---

## ๐ ุชูุงุตูู ุงูุฌุฏุงูู

### 1๏ธโฃ ุงููุญุตูุฉ ุงูุดูุฑูุฉ (monthly_grades)

| ุงูุญูู | ุงูุงุณู ุงูุจุฑูุฌู | ุงูููุน | ุงููุตู | ูุซุงู |
|-------|---------------|-------|-------|------|
| ุงููุนุฑู | `id` | INT (PK) | ูุนุฑู ูุฑูุฏ | 1 |
| ุงูุทุงูุจ | `enrollment_id` | INT (FK) | ุชุณุฌูู ุงูุทุงูุจ | 1 |
| ุงููุงุฏุฉ | `subject_id` | INT (FK) | ุงููุงุฏุฉ ุงูุฏุฑุงุณูุฉ | 1 (ุฑูุงุถูุงุช) |
| ุงูุดูุฑ | `month_id` | INT (FK) | ุงูุดูุฑ ุงูุฃูุงุฏููู | 1 (ูุญุฑู) |
| ุงูููุงุธุจุฉ | `attendance_score` | DECIMAL(5,2) | **ูุญุณูุจ ุขููุงู** | 4.80 |
| ุงููุงุฌุจุงุช | `homework_score` | DECIMAL(5,2) | **ูุญุณูุจ ุขููุงู** | 5.00 |
| ุงููุดุงุท | `activity_score` | DECIMAL(5,2) | ูุฏูู ูู ุงููุนูู | 4.50 |
| ุงููุณุงููุฉ | `contribution_score` | DECIMAL(5,2) | ูุฏูู ูู ุงููุนูู | 0.00 |
| ููููุงุช ูุฎุตุตุฉ | `custom_components_score` | DECIMAL(5,2) | ูู ููููุงุช ุงูุณูุงุณุฉ ุงููุฎุตุตุฉ | 0.00 |
| ุงูุงุฎุชุจุงุฑ | `exam_score` | DECIMAL(5,2) | ูู ุฏุฑุฌุงุช ุงูุงุฎุชุจุงุฑุงุช | 18.50 |

#### ๐ ุจูุงูุงุช ุงุณุชุฑุดุงุฏูุฉ
| id | enrollment_id | subject_id | month_id | attendance | homework | activity | exam | **ุงููุฌููุน** |
|----|---------------|------------|----------|------------|----------|----------|------|-------------|
| 1 | 1 (ูุญูุฏ) | 1 (ุฑูุงุถูุงุช) | 1 (ูุญุฑู) | 4.80 | 5.00 | 4.50 | 18.50 | **32.80** |
| 2 | 2 (ูุฑูู) | 1 (ุฑูุงุถูุงุช) | 1 (ูุญุฑู) | 5.00 | 3.50 | 4.00 | 15.00 | **27.50** |
| 3 | 3 (ุนูุฑ) | 1 (ุฑูุงุถูุงุช) | 1 (ูุญุฑู) | 3.00 | 0.00 | 3.50 | 0.00 | **6.50** |
| 4 | 1 (ูุญูุฏ) | 2 (ุนุฑุจู) | 1 (ูุญุฑู) | 4.80 | 5.00 | 5.00 | 17.00 | **31.80** |

---

### 2๏ธโฃ View: ุญุณุงุจ ุงูููุงุธุจุฉ ุขููุงู (v_auto_attendance_score)

ูุญุณุจ ูุณุจุฉ ุงูุญุถูุฑ ูู `student_attendance` (System 04) ููู ุทุงูุจ ูู ูู ุดูุฑ.

| ุงูุญูู | ุงููุตู |
|-------|-------|
| `enrollment_id` | ุงูุทุงูุจ |
| `month_id` | ุงูุดูุฑ |
| `total_days` | ุฅุฌูุงูู ุฃูุงู ุงูุฏุฑุงุณุฉ |
| `present_days` | ุฃูุงู ุงูุญุถูุฑ |
| `absent_days` | ุฃูุงู ุงูุบูุงุจ |
| `attendance_percentage` | **ูุณุจุฉ ุงูุญุถูุฑ %** |

#### ูุซุงู: ุทุงูุจ ุญุถุฑ 24 ูู 25 ููู
```
attendance_percentage = (24 / 25) ร 100 = 96%
attendance_score = 96% ร 5.00 (max) = 4.80
```

---

### 3๏ธโฃ View: ุญุณุงุจ ุงููุงุฌุจุงุช ุขููุงู (v_auto_homework_score)

ูุญุณุจ ูุชูุณุท ุฏุฑุฌุงุช ุงููุงุฌุจุงุช ูู `v_homework_effective_grade` ููู ุทุงูุจ/ูุงุฏุฉ/ุดูุฑ.

| ุงูุญูู | ุงููุตู |
|-------|-------|
| `enrollment_id` | ุงูุทุงูุจ |
| `subject_id` | ุงููุงุฏุฉ |
| `month_id` | ุงูุดูุฑ |
| `total_homeworks` | ุนุฏุฏ ุงููุงุฌุจุงุช |
| `completed_count` | ุนุฏุฏ ุงูููููุฐุฉ |
| `total_grade` | ูุฌููุน ุงูุฏุฑุฌุงุช ุงููุนููุฉ |
| `total_max_grade` | ุงููุฌููุน ุงูุฃูุตู |

---

### 4๏ธโฃ Procedure: ููุก ุงููุญุตูุงุช ุขููุงู (sp_calculate_monthly_grades)

```sql
CALL sp_calculate_monthly_grades(
    1,  -- month_id (ุงูุดูุฑ)
    1,  -- subject_id (ุงููุงุฏุฉ)
    1   -- classroom_id (ุงููุตู)
);
```

**ูููู ุจู:**
1. ุฌูุจ ุฃูุฒุงู ุงูุณูุงุณุฉ (`grading_policies`) ููุตู ูุงููุงุฏุฉ
2. ุญุณุงุจ `attendance_score` ูู `v_auto_attendance_score`
3. ุญุณุงุจ `homework_score` ูู `v_auto_homework_score`
4. ุฅุฏุฑุงุฌ/ุชุญุฏูุซ `monthly_grades` ููู ุทูุงุจ ุงููุตู

---

## ๐ก ุฃูุซูุฉ SQL

### ุฌูุจ ุงููุญุตูุฉ ุงูุดูุฑูุฉ ููุตู ูุนูู
```sql
SELECT 
    s.full_name,
    mg.attendance_score, mg.homework_score, 
    mg.activity_score, mg.exam_score,
    (mg.attendance_score + mg.homework_score + mg.activity_score + mg.exam_score) AS total
FROM monthly_grades mg
JOIN student_enrollments se ON mg.enrollment_id = se.id
JOIN students s ON se.student_id = s.id
WHERE mg.subject_id = 1 AND mg.month_id = 1
ORDER BY total DESC;
```

---

## ๐งฉ ุนูุงุตุฑ ุชูููุฉ ุฅุถุงููุฉ ููุซูุฉ
- ุฌุฏูู `monthly_grades` ูุญุชูู ุฃูุถุงู ุนูู: `created_at`, `updated_at`.
- View `v_auto_attendance_score` ูุนูุฏ ุฃูุถุงู `semester_id` ูุน ุจูุงูุงุช ุงูุดูุฑ.
- View `v_auto_homework_score` ูุนูุฏ ุฃูุถุงู `avg_grade` (ูุชูุณุท ุงูุฏุฑุฌุฉ ุงููุนููุฉ ูุจู ุฅุนุงุฏุฉ ุงูุชุญุฌูู).
- ุงูุฅุฌุฑุงุก `sp_calculate_monthly_grades` ูุญุณุจ ูุฐูู `exam_score` ูู `student_exam_scores` ุฎูุงู ูุทุงู ุชุงุฑูุฎ ุงูุดูุฑุ ููุณุชุฎุฏู `ON DUPLICATE KEY UPDATE` ูุชุญุฏูุซ ุงูุณุฌูุงุช ุงูููุฌูุฏุฉ.

**ุชู ุงูุชุญุฏูุซ:** 2026-02-14
